<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survival 3D</title>
<style>
body { margin:0; overflow:hidden; background:#87ceeb; font-family:Arial;}
#info { position:fixed; top:10px; left:10px; color:white; font-size:16px; }
</style>
</head>
<body>
<div id="info">ใช้ W/A/S/D เดิน | คลิกขวาใช้ขวาน</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// Scene, Camera, Renderer
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

// Ground
const groundGeo = new THREE.PlaneGeometry(100,100);
const groundMat = new THREE.MeshPhongMaterial({color:0x228B22});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ตัวละคร (กล่อง)
const playerGeo = new THREE.BoxGeometry(1,2,1);
const playerMat = new THREE.MeshPhongMaterial({color:0xff0000});
const player = new THREE.Mesh(playerGeo, playerMat);
player.position.y = 1;
scene.add(player);

// บ้าน (cube)
const houseGeo = new THREE.BoxGeometry(4,4,4);
const houseMat = new THREE.MeshPhongMaterial({color:0x8B4513});
const house = new THREE.Mesh(houseGeo, houseMat);
house.position.set(10,2,0);
scene.add(house);

// ต้นไม้ (cube + cylinder)
function addTree(x,z){
    const trunkGeo = new THREE.CylinderGeometry(0.3,0.3,3);
    const trunkMat = new THREE.MeshPhongMaterial({color:0x8B4513});
    const trunk = new THREE.Mesh(trunkGeo,trunkMat);
    trunk.position.set(x,1.5,z);
    scene.add(trunk);

    const leavesGeo = new THREE.ConeGeometry(1.5,3,8);
    const leavesMat = new THREE.MeshPhongMaterial({color:0x006400});
    const leaves = new THREE.Mesh(leavesGeo, leavesMat);
    leaves.position.set(x,4.5,z);
    scene.add(leaves);
}
for(let i=0;i<20;i++){
    addTree(Math.random()*50-25, Math.random()*50-25);
}

// สัตว์ร้าย (cube)
const enemyGeo = new THREE.BoxGeometry(1,1,1);
const enemyMat = new THREE.MeshPhongMaterial({color:0x0000ff});
const enemy = new THREE.Mesh(enemyGeo, enemyMat);
enemy.position.set(-10,0.5,-10);
scene.add(enemy);

// Controls
const controls = new THREE.PointerLockControls(camera, renderer.domElement);
document.body.addEventListener('click', ()=>{ controls.lock(); });

camera.position.set(0,2,5);
controls.getObject().position.set(player.position.x,player.position.y,player.position.z);
scene.add(controls.getObject());

// การเดิน W/A/S/D
const move = {forward:false,back:false,left:false,right:false};
document.addEventListener('keydown', e=>{
    if(e.key==='w') move.forward=true;
    if(e.key==='s') move.back=true;
    if(e.key==='a') move.left=true;
    if(e.key==='d') move.right=true;
});
document.addEventListener('keyup', e=>{
    if(e.key==='w') move.forward=false;
    if(e.key==='s') move.back=false;
    if(e.key==='a') move.left=false;
    if(e.key==='d') move.right=false;
});

// Animation
function animate(){
    requestAnimationFrame(animate);

    // เดิน
    const speed = 0.1;
    if(move.forward) controls.moveForward(speed);
    if(move.back) controls.moveForward(-speed);
    if(move.left) controls.moveRight(-speed);
    if(move.right) controls.moveRight(speed);

    // ศัตรูเดินเข้าหาตัวผู้เล่น
    const dirX = player.position.x - enemy.position.x;
    const dirZ = player.position.z - enemy.position.z;
    const dist = Math.sqrt(dirX*dirX + dirZ*dirZ);
    if(dist>0.5){
        enemy.position.x += dirX/dist*0.02;
        enemy.position.z += dirZ/dist*0.02;
    }

    renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
